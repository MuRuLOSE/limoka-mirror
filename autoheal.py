__version__ = (1, 0, 4)
# ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤Â© Copyright 2024
# ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤ã…¤https://t.me/unnic
# ğŸ”’ã…¤ã…¤ã…¤ã…¤ã…¤Licensed under the GNU AGPLv3
# ğŸŒã…¤ã…¤https://www.gnu.org/licenses/agpl-3.0.html
# â”â”“â”â”â”“â”â”â”â”“â”â”â”â”“â”â”â”â”â”â”â”â”“â”â”â”â”â”â”â”“â”â”â”â”â”â”â”â”â”â”â”â”
# â”ƒâ”ƒâ”â”ƒâ”ƒâ”â”â”ƒâ”ƒâ”â”â”ƒâ”ƒâ”â”â”ƒâ”â”“â”â”“â”ƒâ”â”â”â”â”â”›â”—â”“â”â”â”â”â”â”â”â”â”â”â”
# â”ƒâ”—â”â”›â”ƒâ”â”“â”ƒâ”ƒâ”â”“â”ƒâ”ƒâ”â”“â”—â”›â”ƒâ”ƒâ”—â”›â”â”“â”â”“â”—â”“â”â”›â”â”â”â”“â”â”â”“â”â”â”â”
# â”ƒâ”â”â”“â”ƒâ”£â”«â”ƒâ”—â”›â”›â”ƒâ”—â”›â”›â”â”â”ƒâ”ƒâ”â”â”ƒâ”ƒâ”ƒâ”ƒâ”â”ƒâ”ƒâ”â”ƒâ”â”“â”ƒâ”ƒâ”â”›â”â”â”â”
# â”ƒâ”ƒâ”â”ƒâ”ƒâ”ƒâ”ƒâ”ƒâ”â”“â”“â”ƒâ”â”“â”“â”â”â”›â”—â”“â”â”ƒâ”—â”›â”ƒâ”â”ƒâ”—â”“â”ƒâ”—â”›â”ƒâ”ƒâ”ƒâ”â”â”â”â”
# â”—â”›â”â”—â”›â”—â”›â”—â”›â”—â”›â”—â”›â”—â”›â”â”—â”â”â”›â”â”—â”â”â”›â”â”—â”â”›â”—â”â”â”›â”—â”›â”â”â”â”â”
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# load from: t.me:HikkTutor 
# meta developer:@HikkTutor 
# author: @unnic
# name: autoheal
# â–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘
# â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
# â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â•šâ•â•
# â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•—
# â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
# â–‘â•šâ•â•â•â•â•â•â–‘â•šâ•â•â–‘â–‘â•šâ•â•â•â•šâ•â•â–‘â–‘â•šâ•â•â•â•šâ•â•â–‘â•šâ•â•â•â•â•

from .. import loader
import asyncio
import traceback

class SmartAutoHeal(loader.Module):
    """ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ…Ğ¸Ğ»Ğ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ³Ğ¾Ñ€ÑÑ‡ĞºĞµ Ğ² Ğ›Ğ¡ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°"""

    strings = {'name': 'AutoHeal'}
    vaccine_needed = False
    healing_in_progress = False
    module_disabled = False
    spam_in_progress = False

    allowed_bots = {
        5443619563,
        5226378684,
        707693258,
        5137994780,
        5434504334
    }

    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "BOT_CHAT_ID",
                5443619563,
                "ID Ñ‡Ğ°Ñ‚Ğ° Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°, Ñ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¼ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ"
            )
        )

    async def client_ready(self, client, db):
        self.me = await client.get_me()

        bot_chat_id = self.config["BOT_CHAT_ID"]
        if bot_chat_id not in self.allowed_bots:
            self.config["BOT_CHAT_ID"] = 5443619563
            await client.send_message(self.me.id, "<b>ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ ID Ğ±Ğ¾Ñ‚Ğ° Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸. ID ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½ Ğ½Ğ° ÑÑ‚Ğ¾ĞºĞ¾Ğ²Ñ‹Ğ¹: 5443619563</b>")

    async def buy_vaccine_if_needed(self, client, chat):
        if not self.vaccine_needed and not self.healing_in_progress:
            self.vaccine_needed = True
            self.healing_in_progress = True

            await asyncio.sleep(1.5)
            await client.send_message(chat, "!ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ²Ğ°ĞºÑ†Ğ¸Ğ½Ñƒ")
            await asyncio.sleep(5)

            last_message = (await client.get_messages(chat, limit=1))[0]
            if "ğŸ“ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ ÑÑ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ¸Ğ¾-Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ¸Ğ»Ğ¸ Ğ¸Ñ€Ğ¸Ñ-ĞºĞ¾Ğ¸Ğ½Ğ¾Ğ²" in last_message.raw_text:
                self.module_disabled = True
                self.vaccine_needed = False
            else:
                self.healing_in_progress = False

    def is_infected_message(self, message_text):
        return ("ĞšÑ‚Ğ¾-Ñ‚Ğ¾ Ğ¿Ğ¾Ğ´Ğ²ĞµÑ€Ğ³ Ğ·Ğ°Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¼ Ğ¿Ğ°Ñ‚Ğ¾Ğ³ĞµĞ½Ğ¾Ğ¼" in message_text or
                "Ğ¿Ğ¾Ğ´Ğ²ĞµÑ€Ğ³ Ğ·Ğ°Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¿Ğ°Ñ‚Ğ¾Ğ³ĞµĞ½Ğ¾Ğ¼" in message_text)

    def is_fever_message(self, message_text):
        return "ğŸ¤’ Ğ£ Ğ²Ğ°Ñ Ğ³Ğ¾Ñ€ÑÑ‡ĞºĞ°, Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ½Ğ½Ğ°Ñ" in message_text

    def is_cured_message(self, message_text):
        return "ğŸ’‰ Ğ’Ğ°ĞºÑ†Ğ¸Ğ½Ğ° Ğ¸Ğ·Ğ»ĞµÑ‡Ğ¸Ğ»Ğ° Ğ²Ğ°Ñ Ğ¾Ñ‚ Ğ³Ğ¾Ñ€ÑÑ‡ĞºĞ¸" in message_text

    def is_buy_vaccine_command(self, message_text):
        return "!ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ²Ğ°ĞºÑ†Ğ¸Ğ½Ñƒ" in message_text

    def is_infect_command(self, message_text):
        return any(cmd in message_text for cmd in ["!Ğ·Ğ°Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ", "/Ğ·Ğ°Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ", "Ğ·Ğ°Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ"])

    async def watcher(self, message):
        try:
            bot_chat_id = self.config["BOT_CHAT_ID"]

            if bot_chat_id not in self.allowed_bots:
                await message.client.send_message(message.chat_id, "<b>ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ID Ğ±Ğ¾Ñ‚Ğ°. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ id Ğ±Ğ¾Ñ‚Ğ°.</b>")
                self.config["BOT_CHAT_ID"] = 5443619563
                await message.client.send_message(message.chat_id, "<b>ID ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½ Ğ½Ğ° ÑÑ‚Ğ¾ĞºĞ¾Ğ²Ñ‹Ğ¹: 5443619563</b>")
                return

            if message.chat_id == bot_chat_id:
                if not self.module_disabled:
                    if self.is_infected_message(message.raw_text) or self.is_fever_message(message.raw_text):
                        if self.spam_in_progress:
                            return

                        self.spam_in_progress = True
                        await self.buy_vaccine_if_needed(message.client, message.chat_id)
                        self.spam_in_progress = False

                    if self.is_cured_message(message.raw_text):
                        self.vaccine_needed = False

                if "ğŸ“ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ ÑÑ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ¸Ğ¾-Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ¸Ğ»Ğ¸ Ğ¸Ñ€Ğ¸Ñ-ĞºĞ¾Ğ¸Ğ½Ğ¾Ğ²" in message.raw_text:
                    self.module_disabled = True
                    await message.client.send_message(message.chat_id, "<b>ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ñ‘Ğ½ Ğ¸Ğ·-Ğ·Ğ° Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ° Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ².</b>")

                if self.is_buy_vaccine_command(message.raw_text) or self.is_infect_command(message.raw_text):
                    if self.module_disabled:
                        self.module_disabled = False
                        await message.client.send_message(message.chat_id, "<b>Ğ¯ Ğ²Ğ¸Ğ¶Ñƒ, Ğ²Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ±Ğ¾Ñ‚Ğ¾Ğ¼.\nĞ’ĞºĞ»ÑÑ‡Ğ°Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ…Ğ¸Ğ».</b>")

        except Exception as e:
            error_trace = traceback.format_exc()
            await message.client.send_message(message.chat_id, f"<b>ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğ¸:</b>\n{str(e)}\n{error_trace}")

    @loader.command(ru_doc="ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¸Ğ³Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ±Ğ¾Ñ‚Ğ¾Ğ²")
    async def show_bots(self, message):
        """Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… Ğ±Ğ¾Ñ‚Ğ¾Ğ² Ğ¸ Ğ¸Ñ… id"""
        await message.client.send_message(
            message.chat_id,
            f"<b>Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ³Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ±Ğ¾Ñ‚Ğ¾Ğ²:</b>\n\n"
            f"ğŸ© <a href='tg://user?id=5443619563'>Iris | Black Diamond</a> â®• <code>5443619563</code>\n"
            f"ğŸŸ£ <a href='tg://user?id=5226378684'>Iris | Deep Purple</a> â®• <code>5226378684</code>\n"
            f"ğŸ”µ <a href='tg://user?id=707693258'>Iris | Ğ§Ğ°Ñ‚-Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€</a> â®• <code>707693258</code>\n"
            f"ğŸŸ¡ <a href='tg://user?id=5137994780'>Iris | Bright Sophie</a> â®• <code>5137994780</code>\n"
            f"âšªï¸ <a href='tg://user?id=5434504334'>Iris | Moonlight Dyla</a> â®• <code>5434504334</code>\n\n"
            f"<b>Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ!</b> id Ğ±Ğ¾Ñ‚Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ.\n"
            f"id Ğ±Ğ¾Ñ‚Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğµ, Ğ±ĞµĞ· @\n\n"
            f"<b>ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ Ñ: </b> ğŸ© <a href='tg://user?id=5443619563'>Iris | Black Diamond</a>",
            parse_mode="HTML"
        )

# Ğ¥ĞµÑ€ # Ğ¥ĞµÑ€Ğ½Ñ # Ğ¥ĞµÑ€Ğ°Ñ‚ĞµĞ½ÑŒ # ĞĞ°Ñ…ĞµÑ€ # Ğ—Ğ°Ñ…ĞµÑ€ # ĞŸĞ¾Ñ…ĞµÑ€
# ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ                     # ĞĞµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ
